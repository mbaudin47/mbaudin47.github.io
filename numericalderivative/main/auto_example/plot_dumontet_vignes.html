<!DOCTYPE html>

<html lang="python" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Experiments with Dumontet &amp; Vignes method &#8212; numericalderivative 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <script src="../_static/documentation_options.js?v=8cfa8c60"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="../_static/Icon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Benchmark Dumontet &amp; Vignes method" href="plot_dumontet_vignes_benchmark.html" />
    <link rel="prev" title="Convergence of the generalized finite differences formulas" href="plot_general_fd_convergence.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-example-plot-dumontet-vignes-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="experiments-with-dumontet-vignes-method">
<span id="sphx-glr-auto-example-plot-dumontet-vignes-py"></span><h1>Experiments with Dumontet &amp; Vignes method<a class="headerlink" href="#experiments-with-dumontet-vignes-method" title="Link to this heading">¶</a></h1>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Dumontet, J., &amp; Vignes, J. (1977). Détermination du pas optimal dans le calcul des dérivées sur ordinateur. RAIRO. Analyse numérique, 11 (1), 13-25.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numericalderivative</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaxNLocator</span>
</pre></div>
</div>
</section>
<section id="use-the-method-on-a-simple-problem">
<h2>Use the method on a simple problem<a class="headerlink" href="#use-the-method-on-a-simple-problem" title="Link to this heading">¶</a></h2>
<p>In the next example, we use the algorithm on the exponential function.
We create the <a class="reference internal" href="../user_manual/_generated/numericalderivative.DumontetVignes.html#numericalderivative.DumontetVignes" title="numericalderivative.DumontetVignes"><code class="xref py py-class docutils literal notranslate"><span class="pre">DumontetVignes</span></code></a> algorithm using the function and the point x.
Then we use the <a class="reference internal" href="../user_manual/_generated/numericalderivative.DumontetVignes.html#numericalderivative.DumontetVignes.find_step" title="numericalderivative.DumontetVignes.find_step"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_step()</span></code></a> method to compute the step,
using an upper bound of the step as an initial point of the algorithm.
Finally, use the <a class="reference internal" href="../user_manual/_generated/numericalderivative.DumontetVignes.html#numericalderivative.DumontetVignes.compute_first_derivative" title="numericalderivative.DumontetVignes.compute_first_derivative"><code class="xref py py-meth docutils literal notranslate"><span class="pre">compute_first_derivative()</span></code></a> method to compute
an approximate value of the first derivative using finite differences.
The <a class="reference internal" href="../user_manual/_generated/numericalderivative.DumontetVignes.html#numericalderivative.DumontetVignes.get_number_of_function_evaluations" title="numericalderivative.DumontetVignes.get_number_of_function_evaluations"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_number_of_function_evaluations()</span></code></a> method
can be used to get the number of function evaluations.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-10</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e0</span>
<span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">DumontetVignes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">step</span><span class="p">,</span> <span class="n">number_of_iterations</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">find_step</span><span class="p">(</span><span class="n">kmin</span><span class="o">=</span><span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="o">=</span><span class="n">kmax</span><span class="p">)</span>
<span class="n">f_prime_approx</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute_first_derivative</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<span class="n">feval</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">get_number_of_function_evaluations</span><span class="p">()</span>
<span class="n">f_prime_exact</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Since the derivative of exp is exp.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computed step = </span><span class="si">{</span><span class="n">step</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of iterations = </span><span class="si">{</span><span class="n">number_of_iterations</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;f_prime_approx = </span><span class="si">{</span><span class="n">f_prime_approx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;f_prime_exact = </span><span class="si">{</span><span class="n">f_prime_exact</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">absolute_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f_prime_approx</span> <span class="o">-</span> <span class="n">f_prime_exact</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>x = 1.000e+00
iteration_maximum = 53
kmin =  1e-10
kmax =  1.0
L(kmin) =  -1.0
L(kmax) =  1.0000000000000113
+ Iteration = 0, kmin = 1.000e-10, kmax = 1.000e+00
  k = 5.000e-01, f3inf = 2.892e+00, f3sup = 2.892e+00, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 1, kmin = 1.000e-10, kmax = 5.000e-01
  k = 2.500e-01, f3inf = 2.761e+00, f3sup = 2.761e+00, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 2, kmin = 1.000e-10, kmax = 2.500e-01
  k = 1.250e-01, f3inf = 2.729e+00, f3sup = 2.729e+00, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 3, kmin = 1.000e-10, kmax = 1.250e-01
  k = 6.250e-02, f3inf = 2.721e+00, f3sup = 2.721e+00, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 4, kmin = 1.000e-10, kmax = 6.250e-02
  k = 3.125e-02, f3inf = 2.719e+00, f3sup = 2.719e+00, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 5, kmin = 1.000e-10, kmax = 3.125e-02
  k = 1.563e-02, f3inf = 2.718e+00, f3sup = 2.718e+00, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 6, kmin = 1.000e-10, kmax = 1.563e-02
  k = 7.813e-03, f3inf = 2.718e+00, f3sup = 2.718e+00, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 7, kmin = 1.000e-10, kmax = 7.813e-03
  k = 3.906e-03, f3inf = 2.718e+00, f3sup = 2.718e+00, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 8, kmin = 1.000e-10, kmax = 3.906e-03
  k = 1.953e-03, f3inf = 2.718e+00, f3sup = 2.718e+00, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 9, kmin = 1.000e-10, kmax = 1.953e-03
  k = 9.766e-04, f3inf = 2.718e+00, f3sup = 2.718e+00, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 10, kmin = 1.000e-10, kmax = 9.766e-04
  k = 4.883e-04, f3inf = 2.718e+00, f3sup = 2.718e+00, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 11, kmin = 1.000e-10, kmax = 4.883e-04
  k = 2.441e-04, f3inf = 2.718e+00, f3sup = 2.719e+00, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 12, kmin = 1.000e-10, kmax = 2.441e-04
  k = 1.221e-04, f3inf = 2.713e+00, f3sup = 2.723e+00, ell = 1.004e+00
  k is too large : reduce kmax
+ Iteration = 13, kmin = 1.000e-10, kmax = 1.221e-04
  k = 6.104e-05, f3inf = 2.680e+00, f3sup = 2.758e+00, ell = 1.029e+00
  k is too large : reduce kmax
+ Iteration = 14, kmin = 1.000e-10, kmax = 6.104e-05
  k = 3.052e-05, f3inf = 2.406e+00, f3sup = 3.031e+00, ell = 1.260e+00
  k is too large : reduce kmax
+ Iteration = 15, kmin = 1.000e-10, kmax = 3.052e-05
Warning: f3inf is zero!
  k = 1.526e-05, f3inf = 0.000e+00, f3sup = 5.000e+00, ell = inf
  k is too small : increase kmin
+ Iteration = 16, kmin = 1.526e-05, kmax = 3.052e-05
  k = 2.289e-05, f3inf = 1.926e+00, f3sup = 3.407e+00, ell = 1.769e+00
  k is too large : reduce kmax
+ Iteration = 17, kmin = 1.526e-05, kmax = 2.289e-05
  k = 1.907e-05, f3inf = 1.536e+00, f3sup = 4.096e+00, ell = 2.667e+00
  k is OK : stop
Computed step = 1.021e-05
Number of iterations = 17
f_prime_approx = 2.7182818285157593
f_prime_exact = 2.718281828459045
</pre></div>
</div>
</section>
<section id="useful-functions">
<h2>Useful functions<a class="headerlink" href="#useful-functions" title="Link to this heading">¶</a></h2>
<p>These functions will be used later in this example.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_ell</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the L ratio for a given value of the step k.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">DumontetVignes</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">relative_precision</span><span class="o">=</span><span class="n">relative_precision</span><span class="p">)</span>
    <span class="n">ell</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute_ell</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ell</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compute_f3_inf_sup</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the upper and lower bounds of the third derivative for a given value of k.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">DumontetVignes</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">relative_precision</span><span class="o">=</span><span class="n">relative_precision</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">f3inf</span><span class="p">,</span> <span class="n">f3sup</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute_ell</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f3inf</span><span class="p">,</span> <span class="n">f3sup</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_step_sensitivity</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">function</span><span class="p">,</span>
    <span class="n">function_derivative</span><span class="p">,</span>
    <span class="n">function_third_derivative</span><span class="p">,</span>
    <span class="n">step_array</span><span class="p">,</span>
    <span class="n">iteration_maximum</span><span class="o">=</span><span class="mi">53</span><span class="p">,</span>
    <span class="n">relative_precision</span><span class="o">=</span><span class="mf">1.0e-15</span><span class="p">,</span>
    <span class="n">kmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">kmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a plot representing the absolute error depending on step.</span>

<span class="sd">    Compute the approximate derivative using central F.D. formula.</span>
<span class="sd">    Plot the approximately optimal step computed by DumontetVignes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : float</span>
<span class="sd">        The input point</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of the problem</span>
<span class="sd">    function : function</span>
<span class="sd">        The function.</span>
<span class="sd">    function_derivative : function</span>
<span class="sd">        The exact first derivative of the function.</span>
<span class="sd">    function_third_derivative : function</span>
<span class="sd">        The exact third derivative of the function.</span>
<span class="sd">    step_array : array(n_points)</span>
<span class="sd">        The array of steps to consider</span>
<span class="sd">    iteration_maximum : int</span>
<span class="sd">        The maximum number of iterations in DumontetVignes</span>
<span class="sd">    relative_precision : float, &gt; 0</span>
<span class="sd">        The relative precision of the function evaluation</span>
<span class="sd">    kmin : float, kmin &gt; 0</span>
<span class="sd">        A minimum bound for k. The default is None.</span>
<span class="sd">        If no value is provided, the default is to compute the smallest</span>
<span class="sd">        possible kmin using number_of_digits and x.</span>
<span class="sd">    kmax : float, kmax &gt; kmin &gt; 0</span>
<span class="sd">        A maximum bound for k. The default is None.</span>
<span class="sd">        If no value is provided, the default is to compute the largest</span>
<span class="sd">        possible kmax using number_of_digits and x.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;+ &quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="c1"># 1. Plot the error vs h</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">DumontetVignes</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">number_of_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">step_array</span><span class="p">)</span>
    <span class="n">error_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_points</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">):</span>
        <span class="n">f_prime_approx</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute_first_derivative</span><span class="p">(</span><span class="n">step_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">error_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f_prime_approx</span> <span class="o">-</span> <span class="n">function_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="c1"># 2. Algorithm to detect h*</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">DumontetVignes</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">relative_precision</span><span class="o">=</span><span class="n">relative_precision</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exact f&#39;&#39;&#39;(x) = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">function_third_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="n">estim_step</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">find_step</span><span class="p">(</span>
        <span class="n">iteration_maximum</span><span class="o">=</span><span class="n">iteration_maximum</span><span class="p">,</span>
        <span class="n">kmin</span><span class="o">=</span><span class="n">kmin</span><span class="p">,</span>
        <span class="n">kmax</span><span class="o">=</span><span class="n">kmax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fprime</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute_first_derivative</span><span class="p">(</span><span class="n">estim_step</span><span class="p">)</span>
    <span class="n">number_of_function_evaluations</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">get_number_of_function_evaluations</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Function evaluations =&quot;</span><span class="p">,</span> <span class="n">number_of_function_evaluations</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Estim. derivative = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fprime</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exact. derivative = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">function_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="n">f_prime_approx</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute_first_derivative</span><span class="p">(</span><span class="n">estim_step</span><span class="p">)</span>
    <span class="n">absolute_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f_prime_approx</span> <span class="o">-</span> <span class="n">function_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exact abs. error  = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absolute_error</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exact rel. error  = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absolute_error</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">function_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>
    <span class="c1"># Compute exact step</span>
    <span class="n">absolute_precision</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">relative_precision</span><span class="p">)</span>
    <span class="n">third_derivative_value</span> <span class="o">=</span> <span class="n">function_third_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">optimal_step</span><span class="p">,</span> <span class="n">optimal_error</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">FirstDerivativeCentral</span><span class="o">.</span><span class="n">compute_step</span><span class="p">(</span>
        <span class="n">third_derivative_value</span><span class="p">,</span> <span class="n">absolute_precision</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exact step     = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">optimal_step</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Estimated step = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">estim_step</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimal abs. error = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">optimal_error</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimal rel. error = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">optimal_error</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">function_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>

    <span class="n">minimum_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">error_array</span><span class="p">)</span>
    <span class="n">maximum_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">error_array</span><span class="p">)</span>

    <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">step_array</span><span class="p">,</span> <span class="n">error_array</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="n">estim_step</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">minimum_error</span><span class="p">,</span> <span class="n">maximum_error</span><span class="p">],</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\widetilde</span><span class="si">{h}</span><span class="s2">$&quot;</span>
    <span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">optimal_step</span><span class="p">,</span> <span class="n">optimal_error</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$h^\star$&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Finite difference for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_ell_ratio</span><span class="p">(</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">function</span><span class="p">,</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">number_of_points</span><span class="p">,</span>
    <span class="n">number_of_digits</span><span class="p">,</span>
    <span class="n">relative_precision</span><span class="p">,</span>
    <span class="n">kmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">kmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y_logscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">plot_L_constants</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">epsilon_ell</span><span class="o">=</span><span class="mf">1.0e-5</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the ell ratio depending on the step size.</span>

<span class="sd">    This ell ratio is used in DumontetVignes.&quot;&quot;&quot;</span>
    <span class="n">ell_1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">15.0</span>  <span class="c1"># Eq. 34, fixed</span>
    <span class="n">ell_2</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">ell_3</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">ell_2</span>
    <span class="n">ell_4</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">ell_1</span>

    <span class="k">if</span> <span class="n">kmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Set default kmin&quot;</span><span class="p">)</span>
        <span class="n">kmin</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">number_of_digits</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Eq. 26</span>
    <span class="k">if</span> <span class="n">kmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Set default kmax&quot;</span><span class="p">)</span>
        <span class="n">kmax</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">number_of_digits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">k_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">kmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">kmax</span><span class="p">),</span> <span class="n">number_of_points</span><span class="p">)</span>
    <span class="n">ell_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_points</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">):</span>
        <span class="n">ell_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_ell</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">relative_precision</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_array</span><span class="p">,</span> <span class="n">ell_array</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot_L_constants</span><span class="p">:</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ell_array</span><span class="p">)</span>
        <span class="n">maximum_finite_ell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ell_array</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;maximum_finite_ell = </span><span class="si">{</span><span class="n">maximum_finite_ell</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;maximum_finite_ell - 1 = </span><span class="si">{</span><span class="n">maximum_finite_ell</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">maximum_finite_ell</span> <span class="o">&lt;=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">epsilon_ell</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;maximum L is lower or equal to 1&quot;</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">k_array</span><span class="p">,</span> <span class="p">[</span><span class="n">ell_1</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_of_points</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;$L_1$ = </span><span class="si">{</span><span class="n">ell_1</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">k_array</span><span class="p">,</span> <span class="p">[</span><span class="n">ell_2</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_of_points</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;$L_2$ = </span><span class="si">{</span><span class="n">ell_2</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;maximum L is greater than 1&quot;</span><span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">k_array</span><span class="p">,</span> <span class="p">[</span><span class="n">ell_3</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_of_points</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;$L_3$ = </span><span class="si">{</span><span class="n">ell_3</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">k_array</span><span class="p">,</span> <span class="p">[</span><span class="n">ell_4</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_of_points</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;$L_4$ = </span><span class="si">{</span><span class="n">ell_4</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, x = </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">, p = </span><span class="si">{</span><span class="n">relative_precision</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">y_logscale</span><span class="p">:</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
</section>
<section id="plot-the-l-ratio-for-various-problems">
<h2>Plot the L ratio for various problems<a class="headerlink" href="#plot-the-l-ratio-for-various-problems" title="Link to this heading">¶</a></h2>
<p>The L ratio is the criterion used in (Dumontet &amp; Vignes, 1977) algorithm
to find a satisfactory step k.
The algorithm searches for a step k so that the L ratio is inside
an interval.
This is computed by the <a class="reference internal" href="../user_manual/_generated/numericalderivative.DumontetVignes.html#numericalderivative.DumontetVignes.compute_ell" title="numericalderivative.DumontetVignes.compute_ell"><code class="xref py py-meth docutils literal notranslate"><span class="pre">compute_ell()</span></code></a>
method.
In the next examples, we plot the L ratio depending on k
for different functions.</p>
<ol class="arabic simple">
<li><p>Consider the <a class="reference internal" href="../user_manual/_generated/numericalderivative.ExponentialProblem.html#numericalderivative.ExponentialProblem" title="numericalderivative.ExponentialProblem"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExponentialProblem</span></code></a> function.</p></li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ExponentialProblem</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span>
<span class="n">problem</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<b>DerivativeBenchmarkProblem</b>
<ul>
<li>name = exp</li>
<li>x = 1.0</li>
<li>f(x) = 2.718281828459045</li>
<li>f'(x) = 2.718281828459045</li>
<li>f''(x) = 2.718281828459045</li>
<li>f^(3)(x) = 2.718281828459045</li>
<li>f^(4)(x) = 2.718281828459045</li>
<li>f^(5)(x) = 2.718281828459045</li>
</ul>

</div>
<br />
<br /><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">number_of_points</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">relative_precision</span> <span class="o">=</span> <span class="mf">1.0e-15</span>
<span class="n">number_of_digits</span> <span class="o">=</span> <span class="mi">53</span>
<span class="n">plot_ell_ratio</span><span class="p">(</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">(),</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">number_of_points</span><span class="p">,</span>
    <span class="n">number_of_digits</span><span class="p">,</span>
    <span class="n">relative_precision</span><span class="p">,</span>
    <span class="n">kmin</span><span class="o">=</span><span class="mf">1.0e-7</span><span class="p">,</span>
    <span class="n">kmax</span><span class="o">=</span><span class="mf">1.0e-3</span><span class="p">,</span>
    <span class="n">plot_L_constants</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dumontet_vignes_001.png" srcset="../_images/sphx_glr_plot_dumontet_vignes_001.png" alt="exp, x = 1.00e+00, p = 1.00e-15" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>maximum_finite_ell = 20.999999999999996, maximum_finite_ell - 1 = 19.999999999999996
maximum L is greater than 1
</pre></div>
</div>
<p>See how the figure changes when the relative precision is
increased: use 1.e-14 (instead of 1.e-15 in the previous example).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">relative_precision</span> <span class="o">=</span> <span class="mf">1.0e-14</span>
<span class="n">number_of_digits</span> <span class="o">=</span> <span class="mi">53</span>
<span class="n">plot_ell_ratio</span><span class="p">(</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">(),</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">number_of_points</span><span class="p">,</span>
    <span class="n">number_of_digits</span><span class="p">,</span>
    <span class="n">relative_precision</span><span class="p">,</span>
    <span class="n">kmin</span><span class="o">=</span><span class="mf">1.0e-7</span><span class="p">,</span>
    <span class="n">kmax</span><span class="o">=</span><span class="mf">1.0e-3</span><span class="p">,</span>
    <span class="n">plot_L_constants</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dumontet_vignes_002.png" srcset="../_images/sphx_glr_plot_dumontet_vignes_002.png" alt="exp, x = 1.00e+00, p = 1.00e-14" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>maximum_finite_ell = 15.153846153846153, maximum_finite_ell - 1 = 14.153846153846153
maximum L is greater than 1
</pre></div>
</div>
<p>See what happens when the relative precision is reduced:
here 1.e-16 instead of 1.e-14 in the previous example.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">relative_precision</span> <span class="o">=</span> <span class="mf">1.0e-16</span>
<span class="n">number_of_digits</span> <span class="o">=</span> <span class="mi">53</span>
<span class="n">plot_ell_ratio</span><span class="p">(</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">(),</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">number_of_points</span><span class="p">,</span>
    <span class="n">number_of_digits</span><span class="p">,</span>
    <span class="n">relative_precision</span><span class="p">,</span>
    <span class="n">kmin</span><span class="o">=</span><span class="mf">1.0e-7</span><span class="p">,</span>
    <span class="n">kmax</span><span class="o">=</span><span class="mf">1.0e-3</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dumontet_vignes_003.png" srcset="../_images/sphx_glr_plot_dumontet_vignes_003.png" alt="exp, x = 1.00e+00, p = 1.00e-16" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>maximum_finite_ell = 3.0, maximum_finite_ell - 1 = 2.0
maximum L is greater than 1
</pre></div>
</div>
<p>We see that it is difficult to find a value of k such that
L(k) is in the required interval when the relative precision is too
close to zero.</p>
</section>
<section id="plot-the-error-depending-on-the-step">
<h2>Plot the error depending on the step<a class="headerlink" href="#plot-the-error-depending-on-the-step" title="Link to this heading">¶</a></h2>
<p>In the next examples, we plot the error of the approximation of the
first derivative by the finite difference formula depending
on the step size.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ExponentialProblem</span><span class="p">()</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>
<span class="n">absolute_precision</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;absolute_precision = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absolute_precision</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>absolute_precision = 1.212e-14
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mf">4.1</span>  <span class="c1"># A carefully chosen point</span>
<span class="n">relative_precision</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">epsilon</span>
<span class="n">number_of_points</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">step_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">15.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">)</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-5</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e-2</span>
<span class="n">plot_step_sensitivity</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_first_derivative</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_third_derivative</span><span class="p">(),</span>
    <span class="n">step_array</span><span class="p">,</span>
    <span class="n">iteration_maximum</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">relative_precision</span><span class="o">=</span><span class="mf">1.0e-15</span><span class="p">,</span>
    <span class="n">kmin</span><span class="o">=</span><span class="n">kmin</span><span class="p">,</span>
    <span class="n">kmax</span><span class="o">=</span><span class="n">kmax</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dumontet_vignes_004.png" srcset="../_images/sphx_glr_plot_dumontet_vignes_004.png" alt="Finite difference for exp" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>+  exp
Exact f&#39;&#39;&#39;(x) = 6.034e+01
Function evaluations = 50
Estim. derivative = 6.034e+01
Exact. derivative = 6.034e+01
Exact abs. error  = 2.184e-10
Exact rel. error  = 3.619e-12
Exact step     = 1.442e-05
Estimated step = 3.705e-06
Optimal abs. error = 6.276e-09
Optimal rel. error = 1.040e-10
</pre></div>
</div>
<p>In the previous figure, we see that the error reaches
a minimum, which is indicated by the green point labeled <span class="math notranslate nohighlight">\(h^\star\)</span>.
The vertical dotted line represents the approximately optimal step <span class="math notranslate nohighlight">\(\widetilde{h}\)</span>
returned by the <a class="reference internal" href="../user_manual/_generated/numericalderivative.DumontetVignes.html#numericalderivative.DumontetVignes.find_step" title="numericalderivative.DumontetVignes.find_step"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_step()</span></code></a> method.
We see that the method correctly computes an approximation of the the optimal step.</p>
<p>Consider the <a class="reference internal" href="../user_manual/_generated/numericalderivative.ScaledExponentialProblem.html#numericalderivative.ScaledExponentialProblem" title="numericalderivative.ScaledExponentialProblem"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScaledExponentialProblem</span></code></a>.
First, we plot the L ratio.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">relative_precision</span> <span class="o">=</span> <span class="mf">1.0e-14</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ScaledExponentialProblem</span><span class="p">()</span>
<span class="n">number_of_digits</span> <span class="o">=</span> <span class="mi">53</span>
<span class="n">plot_ell_ratio</span><span class="p">(</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_x</span><span class="p">(),</span>
    <span class="n">number_of_points</span><span class="p">,</span>
    <span class="n">number_of_digits</span><span class="p">,</span>
    <span class="n">relative_precision</span><span class="p">,</span>
    <span class="n">kmin</span><span class="o">=</span><span class="mf">1.0e-1</span><span class="p">,</span>
    <span class="n">kmax</span><span class="o">=</span><span class="mf">1.0e2</span><span class="p">,</span>
    <span class="n">plot_L_constants</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dumontet_vignes_005.png" srcset="../_images/sphx_glr_plot_dumontet_vignes_005.png" alt="scaled exp, x = 1.00e+00, p = 1.00e-14" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>maximum_finite_ell = 0.9422164726175075, maximum_finite_ell - 1 = -0.05778352738249248
maximum L is lower or equal to 1
</pre></div>
</div>
<p>Then plot the error depending on the step size.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ScaledExponentialProblem</span><span class="p">()</span>
<span class="n">step_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">)</span>
<span class="n">plot_step_sensitivity</span><span class="p">(</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_x</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_first_derivative</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_third_derivative</span><span class="p">(),</span>
    <span class="n">step_array</span><span class="p">,</span>
    <span class="n">relative_precision</span><span class="o">=</span><span class="mf">1.0e-15</span><span class="p">,</span>
    <span class="n">kmin</span><span class="o">=</span><span class="mf">1.0e-2</span><span class="p">,</span>
    <span class="n">kmax</span><span class="o">=</span><span class="mf">1.0e2</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dumontet_vignes_006.png" srcset="../_images/sphx_glr_plot_dumontet_vignes_006.png" alt="Finite difference for scaled exp" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>+  scaled exp
Exact f&#39;&#39;&#39;(x) = -1.000e-18
Function evaluations = 26
Estim. derivative = -1.000e-06
Exact. derivative = -1.000e-06
Exact abs. error  = 3.405e-17
Exact rel. error  = 3.405e-11
Exact step     = 1.442e+01
Estimated step = 1.438e+01
Optimal abs. error = 1.040e-16
Optimal rel. error = 1.040e-10
</pre></div>
</div>
<p>The previous figure shows that the optimal step is close to
<span class="math notranslate nohighlight">\(10^1\)</span>, which may be larger than what we may typically expect
as a step size for a finite difference formula.</p>
</section>
<section id="compute-the-lower-and-upper-bounds-of-the-third-derivative">
<h2>Compute the lower and upper bounds of the third derivative<a class="headerlink" href="#compute-the-lower-and-upper-bounds-of-the-third-derivative" title="Link to this heading">¶</a></h2>
<p>The algorithm is based on bounds of the third derivative, which is
computed by the <a class="reference internal" href="../user_manual/_generated/numericalderivative.DumontetVignes.html#numericalderivative.DumontetVignes.compute_ell" title="numericalderivative.DumontetVignes.compute_ell"><code class="xref py py-meth docutils literal notranslate"><span class="pre">compute_ell()</span></code></a> method.
These bounds are used to find a step which is approximately
optimal to compute the step of the finite difference formula
used for the first derivative.
Hence, it is interesting to compare the bounds computed
by the (Dumontet &amp; Vignes, 1977) algorithm and the
actual value of the third derivative.
To compute the true value of the third derivative,
we use two different methods:</p>
<ul class="simple">
<li><p>a finite difference formula, using <a class="reference internal" href="../user_manual/_generated/numericalderivative.ThirdDerivativeCentral.html#numericalderivative.ThirdDerivativeCentral" title="numericalderivative.ThirdDerivativeCentral"><code class="xref py py-class docutils literal notranslate"><span class="pre">ThirdDerivativeCentral</span></code></a>,</p></li>
<li><p>the exact third derivative, using <a class="reference internal" href="../user_manual/_generated/numericalderivative.SquareRootProblem.html#numericalderivative.SquareRootProblem.get_third_derivative" title="numericalderivative.SquareRootProblem.get_third_derivative"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_third_derivative()</span></code></a>.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">1.0e-3</span>  <span class="c1"># A first guess</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x = &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k = &quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">SquareRootProblem</span><span class="p">()</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>
<span class="n">finite_difference</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ThirdDerivativeCentral</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">approx_f3d</span> <span class="o">=</span> <span class="n">finite_difference</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Approx. f&#39;&#39;(x) = &quot;</span><span class="p">,</span> <span class="n">approx_f3d</span><span class="p">)</span>
<span class="n">third_derivative</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_third_derivative</span><span class="p">()</span>
<span class="n">exact_f3d</span> <span class="o">=</span> <span class="n">third_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exact f&#39;&#39;(x) = &quot;</span><span class="p">,</span> <span class="n">exact_f3d</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>x =  1.0
k =  0.001
Approx. f&#39;&#39;(x) =  0.37500080818375636
Exact f&#39;&#39;(x) =  0.375
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">relative_precision</span> <span class="o">=</span> <span class="mf">1.0e-14</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;relative_precision = &quot;</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">)</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>
<span class="n">f3inf</span><span class="p">,</span> <span class="n">f3sup</span> <span class="o">=</span> <span class="n">compute_f3_inf_sup</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f3inf = &quot;</span><span class="p">,</span> <span class="n">f3inf</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f3sup = &quot;</span><span class="p">,</span> <span class="n">f3sup</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>relative_precision =  1e-14
f3inf =  0.37497116522899887
f3sup =  0.3750306731831188
</pre></div>
</div>
<p>The previous outputs shows that the lower and upper bounds
computed by the algorithm contain, indeed, the true value of the
third derivative in this case.</p>
<p>The algorithm is based on finding an approximatly optimal
step k to compute the third derivative.
The next script computes the error of the central formula for the
finite difference formula depending on the step k.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">number_of_points</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>
<span class="n">third_derivative</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_third_derivative</span><span class="p">()</span>
<span class="n">k_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">6.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">)</span>
<span class="n">error_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_points</span><span class="p">))</span>
<span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ThirdDerivativeCentral</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">):</span>
    <span class="n">f2nde_approx</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">k_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">error_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f2nde_approx</span> <span class="o">-</span> <span class="n">third_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_array</span><span class="p">,</span> <span class="n">error_array</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;F. D. of 3de derivative for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">()))</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">pl</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dumontet_vignes_007.png" srcset="../_images/sphx_glr_plot_dumontet_vignes_007.png" alt="F. D. of 3de derivative for sqrt" class = "sphx-glr-single-img"/></section>
<section id="plot-the-lower-and-upper-bounds-of-the-third-derivative">
<h2>Plot the lower and upper bounds of the third derivative<a class="headerlink" href="#plot-the-lower-and-upper-bounds-of-the-third-derivative" title="Link to this heading">¶</a></h2>
<p>The next figure presents the sensitivity of the
lower and upper bounds of the third derivative to the step k.
Moreover, it presents the approximation of the third derivative
using the central finite difference formula.
This makes it possible to check that the lower and upper bounds
actually contain the approximation produced by the F.D. formula.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">SquareRootProblem</span><span class="p">()</span>
<span class="n">number_of_points</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">relative_precision</span> <span class="o">=</span> <span class="mf">1.0e-16</span>
<span class="n">k_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">)</span>
<span class="n">f3_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_points</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>
<span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ThirdDerivativeCentral</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">):</span>
    <span class="n">f3inf</span><span class="p">,</span> <span class="n">f3sup</span> <span class="o">=</span> <span class="n">compute_f3_inf_sup</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">relative_precision</span><span class="p">)</span>
    <span class="n">f3_approx</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">k_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">f3_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">f3inf</span><span class="p">,</span> <span class="n">f3_approx</span><span class="p">,</span> <span class="n">f3sup</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_array</span><span class="p">,</span> <span class="n">f3_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;f3inf&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_array</span><span class="p">,</span> <span class="n">f3_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$D^{(3)}_f$&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_array</span><span class="p">,</span> <span class="n">f3_array</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;f3sup&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F.D. of 3de derivative for </span><span class="si">{</span><span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span><span class="si">}</span><span class="s2"> at x = </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="n">pl</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dumontet_vignes_008.png" srcset="../_images/sphx_glr_plot_dumontet_vignes_008.png" alt="F.D. of 3de derivative for sqrt at x = 1.0" class = "sphx-glr-single-img"/><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mf">1.0e-2</span>
<span class="n">relative_precision</span> <span class="o">=</span> <span class="mf">1.0e-14</span>
<span class="n">number_of_digits</span> <span class="o">=</span> <span class="mi">53</span>
<span class="n">plot_ell_ratio</span><span class="p">(</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">(),</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">number_of_points</span><span class="p">,</span>
    <span class="n">number_of_digits</span><span class="p">,</span>
    <span class="n">relative_precision</span><span class="p">,</span>
    <span class="n">kmin</span><span class="o">=</span><span class="mf">4.4e-7</span><span class="p">,</span>
    <span class="n">kmax</span><span class="o">=</span><span class="mf">1.0e-5</span><span class="p">,</span>
    <span class="n">plot_L_constants</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dumontet_vignes_009.png" srcset="../_images/sphx_glr_plot_dumontet_vignes_009.png" alt="sqrt, x = 1.00e-02, p = 1.00e-14" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>maximum_finite_ell = 31.85714285714286, maximum_finite_ell - 1 = 30.85714285714286
maximum L is greater than 1
</pre></div>
</div>
<p>The next example searches the optimal step for the square root function.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mf">1.0e-2</span>
<span class="n">relative_precision</span> <span class="o">=</span> <span class="mf">1.0e-14</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-8</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e-3</span>
<span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>
<span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">DumontetVignes</span><span class="p">(</span>
    <span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">relative_precision</span><span class="o">=</span><span class="n">relative_precision</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
<span class="p">)</span>
<span class="n">h_optimal</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">find_step</span><span class="p">(</span><span class="n">kmax</span><span class="o">=</span><span class="n">kmax</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;h optimal = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h_optimal</span><span class="p">))</span>
<span class="n">number_of_feval</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">get_number_of_function_evaluations</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;number_of_feval = </span><span class="si">{</span><span class="n">number_of_feval</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">f_prime_approx</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute_first_derivative</span><span class="p">(</span><span class="n">h_optimal</span><span class="p">)</span>
<span class="n">feval</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">get_number_of_function_evaluations</span><span class="p">()</span>
<span class="n">first_derivative</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_first_derivative</span><span class="p">()</span>
<span class="n">absolute_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f_prime_approx</span> <span class="o">-</span> <span class="n">first_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Abs. error = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absolute_error</span><span class="p">))</span>

<span class="n">ell_kmin</span><span class="p">,</span> <span class="n">f3inf</span><span class="p">,</span> <span class="n">f3sup</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute_ell</span><span class="p">(</span><span class="n">kmin</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;L(kmin) = &quot;</span><span class="p">,</span> <span class="n">ell_kmin</span><span class="p">)</span>
<span class="n">ell_kmax</span><span class="p">,</span> <span class="n">f3inf</span><span class="p">,</span> <span class="n">f3sup</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute_ell</span><span class="p">(</span><span class="n">kmax</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;L(kmax) = &quot;</span><span class="p">,</span> <span class="n">ell_kmax</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>x = 1.000e-02
iteration_maximum = 53
kmin =  2.220446049250313e-18
kmax =  0.001
L(kmin) =  -1.0186915887850467
L(kmax) =  1.0000000001563647
+ Iteration = 0, kmin = 2.220e-18, kmax = 1.000e-03
  k = 5.000e-04, f3inf = 3.771e+04, f3sup = 3.771e+04, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 1, kmin = 2.220e-18, kmax = 5.000e-04
  k = 2.500e-04, f3inf = 3.755e+04, f3sup = 3.755e+04, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 2, kmin = 2.220e-18, kmax = 2.500e-04
  k = 1.250e-04, f3inf = 3.751e+04, f3sup = 3.751e+04, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 3, kmin = 2.220e-18, kmax = 1.250e-04
  k = 6.250e-05, f3inf = 3.750e+04, f3sup = 3.750e+04, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 4, kmin = 2.220e-18, kmax = 6.250e-05
  k = 3.125e-05, f3inf = 3.750e+04, f3sup = 3.750e+04, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 5, kmin = 2.220e-18, kmax = 3.125e-05
  k = 1.563e-05, f3inf = 3.750e+04, f3sup = 3.750e+04, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 6, kmin = 2.220e-18, kmax = 1.563e-05
  k = 7.813e-06, f3inf = 3.749e+04, f3sup = 3.751e+04, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 7, kmin = 2.220e-18, kmax = 7.813e-06
  k = 3.906e-06, f3inf = 3.745e+04, f3sup = 3.755e+04, ell = 1.003e+00
  k is too large : reduce kmax
+ Iteration = 8, kmin = 2.220e-18, kmax = 3.906e-06
  k = 1.953e-06, f3inf = 3.710e+04, f3sup = 3.790e+04, ell = 1.022e+00
  k is too large : reduce kmax
+ Iteration = 9, kmin = 2.220e-18, kmax = 1.953e-06
  k = 9.766e-07, f3inf = 3.427e+04, f3sup = 4.071e+04, ell = 1.188e+00
  k is too large : reduce kmax
+ Iteration = 10, kmin = 2.220e-18, kmax = 9.766e-07
  k = 4.883e-07, f3inf = 1.168e+04, f3sup = 6.318e+04, ell = 5.408e+00
  k is OK : stop
h optimal = 4.311e-07
number_of_feval = 52
Abs. error = 1.151e-09
L(kmin) =  -1.0
L(kmax) =  1.0000000001563647
</pre></div>
</div>
<p>Consider the <a class="reference internal" href="../user_manual/_generated/numericalderivative.SinProblem.html#numericalderivative.SinProblem" title="numericalderivative.SinProblem"><code class="xref py py-class docutils literal notranslate"><span class="pre">SinProblem</span></code></a>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">relative_precision</span> <span class="o">=</span> <span class="mf">1.0e-14</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">SinProblem</span><span class="p">()</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;sin&quot;</span>
<span class="n">number_of_digits</span> <span class="o">=</span> <span class="mi">53</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-5</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e-3</span>
<span class="n">plot_ell_ratio</span><span class="p">(</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">function</span><span class="p">,</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">number_of_points</span><span class="p">,</span>
    <span class="n">number_of_digits</span><span class="p">,</span>
    <span class="n">relative_precision</span><span class="p">,</span>
    <span class="n">kmin</span><span class="o">=</span><span class="n">kmin</span><span class="p">,</span>
    <span class="n">kmax</span><span class="o">=</span><span class="n">kmax</span><span class="p">,</span>
    <span class="n">plot_L_constants</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dumontet_vignes_010.png" srcset="../_images/sphx_glr_plot_dumontet_vignes_010.png" alt="sin, x = 1.00e+00, p = 1.00e-14" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>maximum_finite_ell = 0.9999063046299485, maximum_finite_ell - 1 = -9.369537005154971e-05
maximum L is lower or equal to 1
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">1.0e-3</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x = &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k = &quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>
<span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ThirdDerivativeCentral</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">approx_f3d</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Approx. f&#39;&#39;(x) = &quot;</span><span class="p">,</span> <span class="n">approx_f3d</span><span class="p">)</span>
<span class="n">third_derivative</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_third_derivative</span><span class="p">()</span>
<span class="n">exact_f3d</span> <span class="o">=</span> <span class="n">third_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exact f&#39;&#39;(x) = &quot;</span><span class="p">,</span> <span class="n">exact_f3d</span><span class="p">)</span>
<span class="n">relative_precision</span> <span class="o">=</span> <span class="mf">1.0e-14</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;relative_precision = &quot;</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">)</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>
<span class="n">f3inf</span><span class="p">,</span> <span class="n">f3sup</span> <span class="o">=</span> <span class="n">compute_f3_inf_sup</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f3inf = &quot;</span><span class="p">,</span> <span class="n">f3inf</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f3sup = &quot;</span><span class="p">,</span> <span class="n">f3sup</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>x =  1.0
k =  0.001
Approx. f&#39;&#39;(x) =  -0.5403020253424984
Exact f&#39;&#39;(x) =  -0.5403023058681398
relative_precision =  1e-14
f3inf =  -0.5403273384274598
f3sup =  -0.5402767122575369
</pre></div>
</div>
</section>
<section id="see-the-history-of-steps-during-the-bissection-search">
<h2>See the history of steps during the bissection search<a class="headerlink" href="#see-the-history-of-steps-during-the-bissection-search" title="Link to this heading">¶</a></h2>
<p>In Dumontet &amp; Vignes's method, the bisection algorithm
produces a sequence of steps <span class="math notranslate nohighlight">\((k_i)_{1 \leq i \leq n_{iter}}\)</span>
where <span class="math notranslate nohighlight">\(n_{iter} \in \mathbb{N}\)</span> is the number of iterations.
These steps are meant to converge to an
approximately optimal step of for the central finite difference formula of the
third derivative.
The optimal step <span class="math notranslate nohighlight">\(k^\star\)</span> for the central finite difference formula of the
third derivative can be computed depending on the fifth derivative of the
function.
In the next example, we want to compute the absolute error between
each intermediate step <span class="math notranslate nohighlight">\(k_i\)</span> and the exact value <span class="math notranslate nohighlight">\(k^\star\)</span>
to see how close the algorithm gets to the exact step.
The list of intermediate steps during the algorithm can be obtained
thanks to the <a class="reference internal" href="../user_manual/_generated/numericalderivative.DumontetVignes.html#numericalderivative.DumontetVignes.get_step_history" title="numericalderivative.DumontetVignes.get_step_history"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_step_history()</span></code></a> method.</p>
<p>In the next example, we print the intermediate steps k during
the bissection algorithm that searches for a step such
that the L ratio is satisfactory.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">SinProblem</span><span class="p">()</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span>
<span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">DumontetVignes</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-10</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e0</span>
<span class="n">step</span><span class="p">,</span> <span class="n">number_of_iterations</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">find_step</span><span class="p">(</span><span class="n">kmin</span><span class="o">=</span><span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="o">=</span><span class="n">kmax</span><span class="p">)</span>
<span class="n">step_k_history</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">get_step_history</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of iterations = </span><span class="si">{</span><span class="n">number_of_iterations</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;History of steps k : </span><span class="si">{</span><span class="n">step_k_history</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">last_step_k</span> <span class="o">=</span> <span class="n">step_k_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last step k : </span><span class="si">{</span><span class="n">last_step_k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>x = 1.000e+00
iteration_maximum = 53
kmin =  1e-10
kmax =  1.0
L(kmin) =  -1.0
L(kmax) =  0.999999999999993
+ Iteration = 0, kmin = 1.000e-10, kmax = 1.000e+00
  k = 5.000e-01, f3inf = -5.074e-01, f3sup = -5.074e-01, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 1, kmin = 1.000e-10, kmax = 5.000e-01
  k = 2.500e-01, f3inf = -5.319e-01, f3sup = -5.319e-01, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 2, kmin = 1.000e-10, kmax = 2.500e-01
  k = 1.250e-01, f3inf = -5.382e-01, f3sup = -5.382e-01, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 3, kmin = 1.000e-10, kmax = 1.250e-01
  k = 6.250e-02, f3inf = -5.398e-01, f3sup = -5.398e-01, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 4, kmin = 1.000e-10, kmax = 6.250e-02
  k = 3.125e-02, f3inf = -5.402e-01, f3sup = -5.402e-01, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 5, kmin = 1.000e-10, kmax = 3.125e-02
  k = 1.563e-02, f3inf = -5.403e-01, f3sup = -5.403e-01, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 6, kmin = 1.000e-10, kmax = 1.563e-02
  k = 7.813e-03, f3inf = -5.403e-01, f3sup = -5.403e-01, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 7, kmin = 1.000e-10, kmax = 7.813e-03
  k = 3.906e-03, f3inf = -5.403e-01, f3sup = -5.403e-01, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 8, kmin = 1.000e-10, kmax = 3.906e-03
  k = 1.953e-03, f3inf = -5.403e-01, f3sup = -5.403e-01, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 9, kmin = 1.000e-10, kmax = 1.953e-03
  k = 9.766e-04, f3inf = -5.403e-01, f3sup = -5.403e-01, ell = 1.000e+00
  k is too large : reduce kmax
+ Iteration = 10, kmin = 1.000e-10, kmax = 9.766e-04
  k = 4.883e-04, f3inf = -5.403e-01, f3sup = -5.403e-01, ell = 9.999e-01
  k is too large : reduce kmax
+ Iteration = 11, kmin = 1.000e-10, kmax = 4.883e-04
  k = 2.441e-04, f3inf = -5.405e-01, f3sup = -5.401e-01, ell = 9.993e-01
  k is too large : reduce kmax
+ Iteration = 12, kmin = 1.000e-10, kmax = 2.441e-04
  k = 1.221e-04, f3inf = -5.417e-01, f3sup = -5.388e-01, ell = 9.946e-01
  k is too large : reduce kmax
+ Iteration = 13, kmin = 1.000e-10, kmax = 1.221e-04
  k = 6.104e-05, f3inf = -5.518e-01, f3sup = -5.283e-01, ell = 9.575e-01
  k is too large : reduce kmax
+ Iteration = 14, kmin = 1.000e-10, kmax = 6.104e-05
  k = 3.052e-05, f3inf = -6.328e-01, f3sup = -4.453e-01, ell = 7.037e-01
  k is too large : reduce kmax
+ Iteration = 15, kmin = 1.000e-10, kmax = 3.052e-05
  k = 1.526e-05, f3inf = -1.312e+00, f3sup = 1.875e-01, ell = -1.429e-01
  k is too small : increase kmin
+ Iteration = 16, kmin = 1.526e-05, kmax = 3.052e-05
  k = 2.289e-05, f3inf = -7.778e-01, f3sup = -3.333e-01, ell = 4.286e-01
  k is OK : stop
Number of iterations = 16
History of steps k : [0.50000000005, 0.250000000075, 0.1250000000875, 0.06250000009375001, 0.031250000096875, 0.0156250000984375, 0.007812500099218751, 0.0039062500996093754, 0.0019531250998046875, 0.0009765625999023438, 0.0004882813499511719, 0.00024414072497558597, 0.00012207041248779297, 6.103525624389649e-05, 3.051767812194824e-05, 1.525888906097412e-05, 2.288828359146118e-05]
Last step k : 2.288828359146118e-05
</pre></div>
</div>
<p>Then we compute the exact step, using <a class="reference internal" href="../user_manual/_generated/numericalderivative.ThirdDerivativeCentral.html#numericalderivative.ThirdDerivativeCentral.compute_step" title="numericalderivative.ThirdDerivativeCentral.compute_step"><code class="xref py py-meth docutils literal notranslate"><span class="pre">compute_step()</span></code></a>.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">fifth_derivative</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_fifth_derivative</span><span class="p">()</span>
<span class="n">fifth_derivative_value</span> <span class="o">=</span> <span class="n">fifth_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;f^(5)(x) = </span><span class="si">{</span><span class="n">fifth_derivative_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">absolute_precision</span> <span class="o">=</span> <span class="mf">1.0e-16</span>
<span class="n">exact_step_k</span><span class="p">,</span> <span class="n">absolute_error</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ThirdDerivativeCentral</span><span class="o">.</span><span class="n">compute_step</span><span class="p">(</span>
    <span class="n">fifth_derivative_value</span><span class="p">,</span> <span class="n">absolute_precision</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimal step k for f^(3)(x) = </span><span class="si">{</span><span class="n">exact_step_k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>f^(5)(x) = 0.5403023058681398
Optimal step k for f^(3)(x) = 0.0012721172356439541
</pre></div>
</div>
<p>Plot the absolute error between the exact step k and the intermediate k
of the algorithm.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">error_step_k</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">abs</span><span class="p">(</span><span class="n">step_k_history</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">exact_step_k</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">step_k_history</span><span class="p">))</span>
<span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dumontet &amp; Vignes on </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> at x = </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">step_k_history</span><span class="p">)),</span> <span class="n">error_step_k</span><span class="p">,</span> <span class="s2">&quot;o-&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Iterations&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$|k_i - k^\star|$&quot;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">pl</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dumontet_vignes_011.png" srcset="../_images/sphx_glr_plot_dumontet_vignes_011.png" alt="Dumontet & Vignes on sin at x = 1.0" class = "sphx-glr-single-img"/><p>The previous figure shows that the algorithm gets closer to the optimal
value of the step k in the early iterations.
In the last iterations of the algorithm, the absolute error does not
continue to decrease monotically and produces a final absolute
error close to <span class="math notranslate nohighlight">\(10^{-3}\)</span>.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 1.940 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-example-plot-dumontet-vignes-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/1ebbb955969414ca4e5ea68f00199bc8/plot_dumontet_vignes.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_dumontet_vignes.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/000c31996f90a8f1a5787ffb3552c50f/plot_dumontet_vignes.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_dumontet_vignes.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/ffb5d67fbc8f163bd04121df6d754980/plot_dumontet_vignes.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">plot_dumontet_vignes.zip</span></code></a></p>
</div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">numericalderivative</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/user_manual.html">User manual</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../examples/examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plot_numericalderivative.html">A simple demonstration of the methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_openturns.html">Applies Stepleman &amp; Winarsky method to an OpenTURNS function</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_use_benchmark.html">Use the benchmark problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_finite_differences.html">Use the finite differences formulas</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_general_fd.html">Use the generalized finite differences formulas</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_general_fd_convergence.html">Convergence of the generalized finite differences formulas</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../examples/examples.html#dumontet-vignes">Dumontet &amp; Vignes</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Experiments with Dumontet &amp; Vignes method</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_dumontet_vignes_benchmark.html">Benchmark Dumontet &amp; Vignes method</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/examples.html#gill-murray-saunders-wright">Gill, Murray, Saunders &amp; Wright</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/examples.html#stepleman-winarsky">Stepleman &amp; Winarsky</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/examples.html#shi-xie-xuan-nocedal">Shi, Xie, Xuan &amp; Nocedal</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../examples/examples.html">Examples</a><ul>
      <li>Previous: <a href="plot_general_fd_convergence.html" title="previous chapter">Convergence of the generalized finite differences formulas</a></li>
      <li>Next: <a href="plot_dumontet_vignes_benchmark.html" title="next chapter">Benchmark Dumontet &amp; Vignes method</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;M. Baudin.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/auto_example/plot_dumontet_vignes.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>