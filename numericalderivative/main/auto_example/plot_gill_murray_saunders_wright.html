<!DOCTYPE html>

<html lang="python" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Experiment with Gill, Murray, Saunders and Wright method &#8212; numericalderivative 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <script src="../_static/documentation_options.js?v=8cfa8c60"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="../_static/Icon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Benchmark Gill, Murray, Saunders and Wright method" href="plot_gill_murray_saunders_wright_benchmark.html" />
    <link rel="prev" title="Benchmark Dumontet &amp; Vignes method" href="plot_dumontet_vignes_benchmark.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-example-plot-gill-murray-saunders-wright-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="experiment-with-gill-murray-saunders-and-wright-method">
<span id="sphx-glr-auto-example-plot-gill-murray-saunders-wright-py"></span><h1>Experiment with Gill, Murray, Saunders and Wright method<a class="headerlink" href="#experiment-with-gill-murray-saunders-and-wright-method" title="Link to this heading">¶</a></h1>
<p>Find a step which is near to optimal for a central finite difference
formula.</p>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Gill, P. E., Murray, W., Saunders, M. A., &amp; Wright, M. H. (1983). Computing forward-difference intervals for numerical optimization. SIAM Journal on Scientific and Statistical Computing, 4(2), 310-321.</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numericalderivative</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaxNLocator</span>
</pre></div>
</div>
</section>
<section id="use-the-method-on-a-simple-problem">
<h2>Use the method on a simple problem<a class="headerlink" href="#use-the-method-on-a-simple-problem" title="Link to this heading">¶</a></h2>
<p>In the next example, we use the algorithm on the exponential function.
We create the <a class="reference internal" href="../user_manual/_generated/numericalderivative.GillMurraySaundersWright.html#numericalderivative.GillMurraySaundersWright" title="numericalderivative.GillMurraySaundersWright"><code class="xref py py-class docutils literal notranslate"><span class="pre">GillMurraySaundersWright</span></code></a> algorithm using the function and the point x.
Then we use the <a class="reference internal" href="../user_manual/_generated/numericalderivative.GillMurraySaundersWright.html#numericalderivative.GillMurraySaundersWright.find_step" title="numericalderivative.GillMurraySaundersWright.find_step"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_step()</span></code></a> method to compute the step,
using an upper bound of the step as an initial point of the algorithm.
Finally, use the <a class="reference internal" href="../user_manual/_generated/numericalderivative.GillMurraySaundersWright.html#numericalderivative.GillMurraySaundersWright.compute_first_derivative" title="numericalderivative.GillMurraySaundersWright.compute_first_derivative"><code class="xref py py-meth docutils literal notranslate"><span class="pre">compute_first_derivative()</span></code></a> method to compute
an approximate value of the first derivative using finite differences.
The <a class="reference internal" href="../user_manual/_generated/numericalderivative.GillMurraySaundersWright.html#numericalderivative.GillMurraySaundersWright.get_number_of_function_evaluations" title="numericalderivative.GillMurraySaundersWright.get_number_of_function_evaluations"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_number_of_function_evaluations()</span></code></a> method
can be used to get the number of function evaluations.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">GillMurraySaundersWright</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-10</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e0</span>
<span class="n">step</span><span class="p">,</span> <span class="n">number_of_iterations</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">find_step</span><span class="p">(</span><span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">)</span>
<span class="n">f_prime_approx</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute_first_derivative</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<span class="n">feval</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">get_number_of_function_evaluations</span><span class="p">()</span>
<span class="n">f_prime_exact</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Since the derivative of exp is exp.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computed step = </span><span class="si">{</span><span class="n">step</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of iterations = </span><span class="si">{</span><span class="n">number_of_iterations</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;f_prime_approx = </span><span class="si">{</span><span class="n">f_prime_approx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;f_prime_exact = </span><span class="si">{</span><span class="n">f_prime_exact</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">absolute_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f_prime_approx</span> <span class="o">-</span> <span class="n">f_prime_exact</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>kmin = 1.000e-10, c(kmin) = 9.007e+00
kmax = 1.000e+00, c(kmax) = 1.355e-15
Iter #0, kmin = 1.000e-10, kmax = 1.000e+00, k = 1.000e-05, c(k) = 1.472e-05
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #1, kmin = 1.000e-10, kmax = 1.000e-05, k = 3.162e-08, c(k) = 1.287e+00
  c(k) &gt;= c_threshold_min: increase kmin.
Iter #2, kmin = 3.162e-08, kmax = 1.000e-05, k = 5.623e-07, c(k) = 4.650e-03
  c in [0.001, 0.1]: stop!
Computed step = 3.835e-08
Number of iterations = 2
f_prime_approx = 2.71828188987139
f_prime_exact = 2.718281828459045
</pre></div>
</div>
</section>
<section id="test-the-method-on-the-exponential-problem">
<h2>Test the method on the exponential problem<a class="headerlink" href="#test-the-method-on-the-exponential-problem" title="Link to this heading">¶</a></h2>
<p>The next function is an oracle which returns the absolute precision
of the value of the function.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">absolute_precision_oracle</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the absolute precision of the function value</span>

<span class="sd">    This oracle may fail if the function value is zero.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    function : function</span>
<span class="sd">        The function</span>
<span class="sd">    x : float</span>
<span class="sd">        The test point</span>
<span class="sd">    relative_precision : float, &gt; 0, optional</span>
<span class="sd">        The relative precision of evaluation of f.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    absolute_precision : float, &gt;= 0</span>
<span class="sd">        The absolute precision</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">function_value</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">function_value</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The function value is zero: &quot;</span> <span class="s2">&quot;cannot compute the absolute precision&quot;</span>
        <span class="p">)</span>
    <span class="n">absolute_precision</span> <span class="o">=</span> <span class="n">relative_precision</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">function_value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">absolute_precision</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">GillMurraySaundersWrightMethod</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a GillMurraySaundersWright method to compute the approximate first derivative</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        kmin : float, kmin &gt; 0</span>
<span class="sd">            A minimum bound for the finite difference step of the third derivative.</span>
<span class="sd">            If no value is provided, the default is to compute the smallest</span>
<span class="sd">            possible kmin using number_of_digits and x.</span>
<span class="sd">        kmax : float, kmax &gt; kmin &gt; 0</span>
<span class="sd">            A maximum bound for the finite difference step of the third derivative.</span>
<span class="sd">            If no value is provided, the default is to compute the largest</span>
<span class="sd">            possible kmax using number_of_digits and x.</span>
<span class="sd">        relative_precision : float, &gt; 0, optional</span>
<span class="sd">            The relative precision of evaluation of f.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kmin</span> <span class="o">=</span> <span class="n">kmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kmax</span> <span class="o">=</span> <span class="n">kmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relative_precision</span> <span class="o">=</span> <span class="n">relative_precision</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_first_derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the first derivative using GillMurraySaundersWright</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        function : function</span>
<span class="sd">            The function</span>
<span class="sd">        x : float</span>
<span class="sd">            The test point</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        f_prime_approx : float</span>
<span class="sd">            The approximate value of the first derivative of the function at point x</span>
<span class="sd">        number_of_function_evaluations : int</span>
<span class="sd">            The number of function evaluations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">absolute_precision</span> <span class="o">=</span> <span class="n">absolute_precision_oracle</span><span class="p">(</span>
            <span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">relative_precision</span>
        <span class="p">)</span>
        <span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">GillMurraySaundersWright</span><span class="p">(</span>
            <span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">absolute_precision</span><span class="o">=</span><span class="n">absolute_precision</span>
        <span class="p">)</span>
        <span class="n">step</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">find_step</span><span class="p">(</span><span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">)</span>
        <span class="n">f_prime_approx</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute_first_derivative</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="n">number_of_function_evaluations</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">get_number_of_function_evaluations</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">f_prime_approx</span><span class="p">,</span> <span class="n">number_of_function_evaluations</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_first_derivative_GMSW</span><span class="p">(</span>
    <span class="n">function</span><span class="p">,</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">first_derivative</span><span class="p">,</span>
    <span class="n">kmin</span><span class="p">,</span>
    <span class="n">kmax</span><span class="p">,</span>
    <span class="n">relative_precision</span><span class="o">=</span><span class="mf">1.0e-15</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the approximate derivative from finite differences</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    function : function</span>
<span class="sd">        The function.</span>
<span class="sd">    x : float</span>
<span class="sd">        The point where the derivative is to be evaluated</span>
<span class="sd">    first_derivative : function</span>
<span class="sd">        The exact first derivative of the function.</span>
<span class="sd">    kmin : float, &gt; 0</span>
<span class="sd">        The minimum step k for the second derivative.</span>
<span class="sd">    kmax : float, &gt; kmin</span>
<span class="sd">        The maximum step k for the second derivative.</span>
<span class="sd">    relative_precision : float, &gt; 0, optional</span>
<span class="sd">        The relative precision of evaluation of f.</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        Set to True to print intermediate messages. The default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    relative_error : float, &gt; 0</span>
<span class="sd">        The relative error between the approximate first derivative</span>
<span class="sd">        and the true first derivative.</span>

<span class="sd">    feval : int</span>
<span class="sd">        The number of function evaluations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">method</span> <span class="o">=</span> <span class="n">GillMurraySaundersWrightMethod</span><span class="p">(</span><span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">)</span>
    <span class="n">f_prime_approx</span><span class="p">,</span> <span class="n">number_of_function_evaluations</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">compute_first_derivative</span><span class="p">(</span>
        <span class="n">function</span><span class="p">,</span> <span class="n">x</span>
    <span class="p">)</span>
    <span class="n">f_prime_exact</span> <span class="o">=</span> <span class="n">first_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computed step = </span><span class="si">{</span><span class="n">step</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of iterations = </span><span class="si">{</span><span class="n">number_of_iterations</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;f_prime_approx = </span><span class="si">{</span><span class="n">f_prime_approx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;f_prime_exact = </span><span class="si">{</span><span class="n">f_prime_exact</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">absolute_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f_prime_approx</span> <span class="o">-</span> <span class="n">f_prime_exact</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">absolute_error</span><span class="p">,</span> <span class="n">number_of_function_evaluations</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;+ Test on ExponentialProblem&quot;</span><span class="p">)</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-15</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e1</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ExponentialProblem</span><span class="p">()</span>
<span class="n">problem</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>+ Test on ExponentialProblem
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<b>DerivativeBenchmarkProblem</b>
<ul>
<li>name = exp</li>
<li>x = 1.0</li>
<li>f(x) = 2.718281828459045</li>
<li>f'(x) = 2.718281828459045</li>
<li>f''(x) = 2.718281828459045</li>
<li>f^(3)(x) = 2.718281828459045</li>
<li>f^(4)(x) = 2.718281828459045</li>
<li>f^(5)(x) = 2.718281828459045</li>
</ul>

</div>
<br />
<br /><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">second_derivative_value</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">second_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">optimal_step</span><span class="p">,</span> <span class="n">absolute_error</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">FirstDerivativeForward</span><span class="o">.</span><span class="n">compute_step</span><span class="p">(</span>
    <span class="n">second_derivative_value</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exact h* = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">optimal_step</span><span class="p">))</span>
<span class="p">(</span>
    <span class="n">absolute_error</span><span class="p">,</span>
    <span class="n">number_of_function_evaluations</span><span class="p">,</span>
<span class="p">)</span> <span class="o">=</span> <span class="n">compute_first_derivative_GMSW</span><span class="p">(</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">function</span><span class="p">,</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">first_derivative</span><span class="p">,</span>
    <span class="n">kmin</span><span class="p">,</span>
    <span class="n">kmax</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;x = </span><span class="si">%.3f</span><span class="s2">, error = </span><span class="si">%.3e</span><span class="s2">, Func. eval. = </span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">absolute_error</span><span class="p">,</span> <span class="n">number_of_function_evaluations</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Exact h* = 1.213e-08
Computed step = 3.835e-08
Number of iterations = 2
f_prime_approx = 2.7182819133272096
f_prime_exact = 2.718281828459045
x = 1.000, error = 8.487e-08, Func. eval. = 18
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;+ Test on ScaledExponentialDerivativeBenchmark&quot;</span><span class="p">)</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-9</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e8</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ScaledExponentialProblem</span><span class="p">()</span>
<span class="n">second_derivative</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_second_derivative</span><span class="p">()</span>
<span class="n">second_derivative_value</span> <span class="o">=</span> <span class="n">second_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">optimal_step</span><span class="p">,</span> <span class="n">absolute_error</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">FirstDerivativeForward</span><span class="o">.</span><span class="n">compute_step</span><span class="p">(</span>
    <span class="n">second_derivative_value</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exact h* = </span><span class="si">%.3e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">optimal_step</span><span class="p">))</span>
<span class="p">(</span>
    <span class="n">absolute_error</span><span class="p">,</span>
    <span class="n">number_of_function_evaluations</span><span class="p">,</span>
<span class="p">)</span> <span class="o">=</span> <span class="n">compute_first_derivative_GMSW</span><span class="p">(</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">(),</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_first_derivative</span><span class="p">(),</span>
    <span class="n">kmin</span><span class="p">,</span>
    <span class="n">kmax</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;x = </span><span class="si">%.3f</span><span class="s2">, error = </span><span class="si">%.3e</span><span class="s2">, Func. eval. = </span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">absolute_error</span><span class="p">,</span> <span class="n">number_of_function_evaluations</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>+ Test on ScaledExponentialDerivativeBenchmark
Exact h* = 2.000e-02
Computed step = 3.835e-08
Number of iterations = 2
f_prime_approx = -9.999989687168326e-07
f_prime_exact = -9.999990000004999e-07
x = 1.000, error = 3.128e-14, Func. eval. = 12
</pre></div>
</div>
</section>
<section id="benchmark-the-method-on-a-collection-of-test-points">
<h2>Benchmark the method on a collection of test points<a class="headerlink" href="#benchmark-the-method-on-a-collection-of-test-points" title="Link to this heading">¶</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;+ Benchmark on several points on ScaledExponentialProblem&quot;</span><span class="p">)</span>
<span class="n">number_of_test_points</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ScaledExponentialProblem</span><span class="p">()</span>
<span class="n">interval</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_interval</span><span class="p">()</span>
<span class="n">test_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">number_of_test_points</span><span class="p">)</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-12</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e1</span>
<span class="n">relative_precision</span> <span class="o">=</span> <span class="mf">1.0e-15</span>
<span class="n">method</span> <span class="o">=</span> <span class="n">GillMurraySaundersWrightMethod</span><span class="p">(</span><span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">)</span>
<span class="n">average_error</span><span class="p">,</span> <span class="n">average_feval</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">benchmark_method</span><span class="p">(</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_fifth_derivative</span><span class="p">(),</span>
    <span class="n">test_points</span><span class="p">,</span>
    <span class="n">method</span><span class="o">.</span><span class="n">compute_first_derivative</span><span class="p">,</span>
    <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average error =&quot;</span><span class="p">,</span> <span class="n">average_error</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average number of function evaluations =&quot;</span><span class="p">,</span> <span class="n">average_feval</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>+ Benchmark on several points on ScaledExponentialProblem
Average error = 9.999999683394813e+23
Average number of function evaluations = 16.0
</pre></div>
</div>
</section>
<section id="plot-the-condition-error-depending-on-the-step">
<h2>Plot the condition error depending on the step<a class="headerlink" href="#plot-the-condition-error-depending-on-the-step" title="Link to this heading">¶</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_condition_error</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">number_of_points</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="c1"># Plot the condition error depending on k.</span>
    <span class="n">k_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">kmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">kmax</span><span class="p">),</span> <span class="n">number_of_points</span><span class="p">)</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">GillMurraySaundersWright</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">c_min</span><span class="p">,</span> <span class="n">c_max</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">get_threshold_min_max</span><span class="p">()</span>
    <span class="n">condition_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_points</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">):</span>
        <span class="n">condition_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute_condition</span><span class="p">(</span><span class="n">k_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="c1">#</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Condition error of </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> at x = </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_array</span><span class="p">,</span> <span class="n">condition_array</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">],</span> <span class="p">[</span><span class="n">c_min</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$c_</span><span class="si">{min}</span><span class="s2">$&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">],</span> <span class="p">[</span><span class="n">c_max</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$c_</span><span class="si">{max}</span><span class="s2">$&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$h_\Phi$&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$c(h_\Phi$)&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
<p>The next plot presents the condition error <span class="math notranslate nohighlight">\(c(h_\Phi)\)</span> depending
on <span class="math notranslate nohighlight">\(h_\Phi\)</span>.
The two horizontal lines represent the minimum and maximum threshold
values.
We search for the value of <span class="math notranslate nohighlight">\(h_\Phi\)</span> such that the condition
error is between these two limits.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">number_of_points</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ScaledExponentialProblem</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-10</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e5</span>
<span class="n">plot_condition_error</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_gill_murray_saunders_wright_001.png" srcset="../_images/sphx_glr_plot_gill_murray_saunders_wright_001.png" alt="Condition error of scaled exp at x = 1.0" class = "sphx-glr-single-img"/><p>The previous plot shows that the condition error is a decreasing function
of <span class="math notranslate nohighlight">\(h_\Phi\)</span>.</p>
<p>Remove the end points <span class="math notranslate nohighlight">\(x = \pm \pi\)</span>, because sin has a zero
second derivative at these points.
This makes the algorithm fail.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;+ Benchmark on several points on SinProblem&quot;</span><span class="p">)</span>
<span class="n">number_of_test_points</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">SinProblem</span><span class="p">()</span>
<span class="n">interval</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_interval</span><span class="p">()</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1.0e-3</span>
<span class="n">test_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">number_of_test_points</span>
<span class="p">)</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-12</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e1</span>
<span class="n">relative_precision</span> <span class="o">=</span> <span class="mf">1.0e-15</span>
<span class="n">method</span> <span class="o">=</span> <span class="n">GillMurraySaundersWrightMethod</span><span class="p">(</span><span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">)</span>
<span class="n">average_error</span><span class="p">,</span> <span class="n">average_feval</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">benchmark_method</span><span class="p">(</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">(),</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">get_fifth_derivative</span><span class="p">(),</span>
    <span class="n">test_points</span><span class="p">,</span>
    <span class="n">method</span><span class="o">.</span><span class="n">compute_first_derivative</span><span class="p">,</span>
    <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average error =&quot;</span><span class="p">,</span> <span class="n">average_error</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average number of function evaluations =&quot;</span><span class="p">,</span> <span class="n">average_feval</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>+ Benchmark on several points on SinProblem
Average error = 1.0720752779539923e-07
Average number of function evaluations = 18.0
</pre></div>
</div>
<p>Plot the condition error depending on k.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">number_of_points</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">SinProblem</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-17</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e-10</span>
<span class="n">plot_condition_error</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_gill_murray_saunders_wright_002.png" srcset="../_images/sphx_glr_plot_gill_murray_saunders_wright_002.png" alt="Condition error of sin at x = -3.141592653589793" class = "sphx-glr-single-img"/><p>In the previous plot, we see that there is no satisfactory
value of <span class="math notranslate nohighlight">\(h_\Phi\)</span> for the sin function
at point <span class="math notranslate nohighlight">\(x = -\pi\)</span>.</p>
</section>
<section id="plot-the-error-depending-on-the-step">
<h2>Plot the error depending on the step<a class="headerlink" href="#plot-the-error-depending-on-the-step" title="Link to this heading">¶</a></h2>
<p>For each function, at point x = 1, plot the error vs the step computed
by the method</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_error_vs_h_with_GMSW_steps</span><span class="p">(</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">function</span><span class="p">,</span>
    <span class="n">first_derivative</span><span class="p">,</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">step_array</span><span class="p">,</span>
    <span class="n">kmin</span><span class="p">,</span>
    <span class="n">kmax</span><span class="p">,</span>
    <span class="n">relative_precision</span><span class="o">=</span><span class="mf">1.0e-15</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the computed error depending on the step for an array of F.D. steps</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of the problem</span>
<span class="sd">    function : function</span>
<span class="sd">        The function.</span>
<span class="sd">    first_derivative : function</span>
<span class="sd">        The exact first derivative of the function</span>
<span class="sd">    x : float</span>
<span class="sd">        The input point where the test is done</span>
<span class="sd">    step_array : list(float)</span>
<span class="sd">        The array of finite difference steps</span>
<span class="sd">    kmin : float, &gt; 0</span>
<span class="sd">        The minimum step k for the second derivative.</span>
<span class="sd">    kmax : float, &gt; kmin</span>
<span class="sd">        The maximum step k for the second derivative.</span>
<span class="sd">    relative_precision : float, optional</span>
<span class="sd">        The relative precision of the function f at the point x.</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        Set to True to print intermediate messages. The default is False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">function_value</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">function_value</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The function value is zero: cannot compute &quot;</span>
            <span class="s2">&quot;the absolute precision from the relative precision. &quot;</span>
            <span class="s2">&quot;Please set the absolute precision specifically.&quot;</span>
        <span class="p">)</span>
    <span class="n">absolute_precision</span> <span class="o">=</span> <span class="n">relative_precision</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">function_value</span><span class="p">)</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">GillMurraySaundersWright</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">absolute_precision</span><span class="p">)</span>
    <span class="n">number_of_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">step_array</span><span class="p">)</span>
    <span class="n">error_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_points</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">):</span>
        <span class="n">f_prime_approx</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">compute_first_derivative</span><span class="p">(</span><span class="n">step_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">error_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f_prime_approx</span> <span class="o">-</span> <span class="n">first_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="n">step</span><span class="p">,</span> <span class="n">number_of_iterations</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">find_step</span><span class="p">(</span><span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step h* = </span><span class="si">{</span><span class="n">step</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2"> using </span><span class="si">{</span><span class="n">number_of_iterations</span><span class="si">}</span><span class="s2"> iterations&quot;</span><span class="p">)</span>

    <span class="n">minimum_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">error_array</span><span class="p">)</span>
    <span class="n">maximum_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">error_array</span><span class="p">)</span>

    <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">step_array</span><span class="p">,</span> <span class="n">error_array</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">[</span><span class="n">minimum_error</span><span class="p">,</span> <span class="n">maximum_error</span><span class="p">],</span>
        <span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\hat</span><span class="si">{h}</span><span class="s2">$&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(GMS &amp; W). </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> at point x = </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_error_vs_h_benchmark</span><span class="p">(</span>
    <span class="n">problem</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">step_array</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">relative_precision</span><span class="o">=</span><span class="mf">1.0e-15</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the computed error depending on the step for an array of F.D. steps</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    problem : nd.BenchmarkProblem</span>
<span class="sd">        The problem</span>
<span class="sd">    x : float</span>
<span class="sd">        The input point where the test is done</span>
<span class="sd">    step_array : list(float)</span>
<span class="sd">        The array of finite difference steps</span>
<span class="sd">    kmin : float, &gt; 0</span>
<span class="sd">        The minimum step k for the second derivative.</span>
<span class="sd">    kmax : float, &gt; kmin</span>
<span class="sd">        The maximum step k for the second derivative.</span>
<span class="sd">    relative_precision : float, optional</span>
<span class="sd">        The relative error of the function f at the point x.</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        Set to True to print intermediate messages. The default is False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plot_error_vs_h_with_GMSW_steps</span><span class="p">(</span>
        <span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
        <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">(),</span>
        <span class="n">problem</span><span class="o">.</span><span class="n">get_first_derivative</span><span class="p">(),</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">step_array</span><span class="p">,</span>
        <span class="n">kmin</span><span class="p">,</span>
        <span class="n">kmax</span><span class="p">,</span>
        <span class="n">relative_precision</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ExponentialProblem</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">number_of_points</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">step_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">15.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">)</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-15</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e-1</span>
<span class="n">relative_precision</span> <span class="o">=</span> <span class="mf">1.0e-15</span>
<span class="n">plot_error_vs_h_benchmark</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">step_array</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_gill_murray_saunders_wright_003.png" srcset="../_images/sphx_glr_plot_gill_murray_saunders_wright_003.png" alt="(GMS & W). exp at point x = 1.0" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>exp
Step h* = 6.322e-08 using 2 iterations
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="n">step_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">15.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">)</span>
<span class="n">plot_error_vs_h_benchmark</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">step_array</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_gill_murray_saunders_wright_004.png" srcset="../_images/sphx_glr_plot_gill_murray_saunders_wright_004.png" alt="(GMS & W). exp at point x = 12.0" class = "sphx-glr-single-img"/><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">ScaledExponentialProblem</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-10</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e8</span>
<span class="n">step_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">)</span>
<span class="n">plot_error_vs_h_benchmark</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">step_array</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_gill_murray_saunders_wright_005.png" srcset="../_images/sphx_glr_plot_gill_murray_saunders_wright_005.png" alt="(GMS & W). scaled exp at point x = 1.0" class = "sphx-glr-single-img"/><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">LogarithmicProblem</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.1</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-14</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e-1</span>
<span class="n">step_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">15.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">)</span>
<span class="n">plot_error_vs_h_benchmark</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">step_array</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_gill_murray_saunders_wright_006.png" srcset="../_images/sphx_glr_plot_gill_murray_saunders_wright_006.png" alt="(GMS & W). log at point x = 1.1" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>log
Step h* = 2.148e-08 using 3 iterations
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">SinProblem</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-15</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e-1</span>
<span class="n">step_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">15.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">)</span>
<span class="n">plot_error_vs_h_benchmark</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">step_array</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_gill_murray_saunders_wright_007.png" srcset="../_images/sphx_glr_plot_gill_murray_saunders_wright_007.png" alt="(GMS & W). sin at point x = 1.0" class = "sphx-glr-single-img"/><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">SquareRootProblem</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-15</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e-1</span>
<span class="n">step_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">15.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">)</span>
<span class="n">plot_error_vs_h_benchmark</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">step_array</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">relative_precision</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_gill_murray_saunders_wright_008.png" srcset="../_images/sphx_glr_plot_gill_murray_saunders_wright_008.png" alt="(GMS & W). sqrt at point x = 1.0" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>sqrt
Step h* = 1.264e-07 using 2 iterations
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">AtanProblem</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">1.1</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-15</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e-1</span>
<span class="n">step_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">15.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">)</span>
<span class="n">plot_error_vs_h_benchmark</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">step_array</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_gill_murray_saunders_wright_009.png" srcset="../_images/sphx_glr_plot_gill_murray_saunders_wright_009.png" alt="(GMS & W). atan at point x = 1.1" class = "sphx-glr-single-img"/></section>
<section id="see-the-history-of-steps-during-the-bissection-search">
<h2>See the history of steps during the bissection search<a class="headerlink" href="#see-the-history-of-steps-during-the-bissection-search" title="Link to this heading">¶</a></h2>
<p>In G, M, S &amp; W's method, the bisection algorithm
produces a sequence of steps <span class="math notranslate nohighlight">\((k_i)_{1 \leq i \leq n_{iter}}\)</span>
where <span class="math notranslate nohighlight">\(n_{iter} \in \mathbb{N}\)</span> is the number of iterations.
These steps are meant to converge to an
approximately optimal step of for the central finite difference formula of the
second derivative.
The optimal step <span class="math notranslate nohighlight">\(k^\star\)</span> for the central finite difference formula of the
second derivative can be computed depending on the fourth derivative of the
function.
In the next example, we want to compute the absolute error between
each intermediate step <span class="math notranslate nohighlight">\(k_i\)</span> and the exact value <span class="math notranslate nohighlight">\(k^\star\)</span>
to see how close the algorithm gets to the exact step.
The list of intermediate steps during the algorithm can be obtained
thanks to the <a class="reference internal" href="../user_manual/_generated/numericalderivative.GillMurraySaundersWright.html#numericalderivative.GillMurraySaundersWright.get_step_history" title="numericalderivative.GillMurraySaundersWright.get_step_history"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_step_history()</span></code></a> method.</p>
<p>In the next example, we print the intermediate steps k during
the bissection algorithm that searches for a step such
that the L ratio is satisfactory.
The algorithm has two different methods to update the step:</p>
<ul class="simple">
<li><p>using the mean,</p></li>
<li><p>using the mean in the logarithm space (this is generally much faster).</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_GMSW_step_history</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">logscale</span><span class="p">):</span>
    <span class="n">function</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_function</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">GillMurraySaundersWright</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">step</span><span class="p">,</span> <span class="n">number_of_iterations</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">find_step</span><span class="p">(</span>
        <span class="n">kmin</span><span class="o">=</span><span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="o">=</span><span class="n">kmax</span><span class="p">,</span> <span class="n">logscale</span><span class="o">=</span><span class="n">logscale</span>
    <span class="p">)</span>
    <span class="n">step_k_history</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">get_step_history</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of iterations = </span><span class="si">{</span><span class="n">number_of_iterations</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;History of steps k : </span><span class="si">{</span><span class="n">step_k_history</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">last_step_k</span> <span class="o">=</span> <span class="n">step_k_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last step k : </span><span class="si">{</span><span class="n">last_step_k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Then we compute the exact step, using :meth:`~numericalderivative.SecondDerivativeCentral.compute_step`.</span>
    <span class="n">fourth_derivative</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_fourth_derivative</span><span class="p">()</span>
    <span class="n">fourth_derivative_value</span> <span class="o">=</span> <span class="n">fourth_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;f^(4)(x) = </span><span class="si">{</span><span class="n">fourth_derivative_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">absolute_precision</span> <span class="o">=</span> <span class="mf">1.0e-16</span>
    <span class="n">exact_step_k</span><span class="p">,</span> <span class="n">absolute_error</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">SecondDerivativeCentral</span><span class="o">.</span><span class="n">compute_step</span><span class="p">(</span>
        <span class="n">fourth_derivative_value</span><span class="p">,</span> <span class="n">absolute_precision</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Optimal step k for f^(2)(x) = </span><span class="si">{</span><span class="n">exact_step_k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Plot the absolute error between the exact step k and the intermediate k</span>
    <span class="c1"># of the algorithm.</span>
    <span class="n">error_step_k</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">abs</span><span class="p">(</span><span class="n">step_k_history</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">exact_step_k</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">step_k_history</span><span class="p">))</span>
    <span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GMSW on </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> at x = </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">. Log scale = </span><span class="si">{</span><span class="n">logscale</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">step_k_history</span><span class="p">)),</span> <span class="n">error_step_k</span><span class="p">,</span> <span class="s2">&quot;o-&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Iterations&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$|k_i - k^\star|$&quot;</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<p>First, test the logarithmic log scale.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">SinProblem</span><span class="p">()</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-15</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e3</span>
<span class="n">logscale</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">plot_GMSW_step_history</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">logscale</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_gill_murray_saunders_wright_010.png" srcset="../_images/sphx_glr_plot_gill_murray_saunders_wright_010.png" alt="GMSW on sin at x = 1.0. Log scale = True" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>kmin = 1.000e-15, c(kmin) = inf
kmax = 1.000e+03, c(kmax) = 5.431e-15
Iter #0, kmin = 1.000e-15, kmax = 1.000e+03, k = 1.000e-06, c(k) = 4.753e-03
  c in [0.001, 0.1]: stop!
Number of iterations = 0
History of steps k : [np.float64(1.0000000000000004e-06)]
Last step k : 1.0000000000000004e-06
f^(4)(x) = 0.8414709848078965
Optimal step k for f^(2)(x) = 0.0002748213843759035
</pre></div>
</div>
<p>The previous figure shows that the algorithm does not necessarily
reduce the distance to the optimal step when we use the logarithmic scale.
The algorithm quickly stops and gets an error approximately equal to <span class="math notranslate nohighlight">\(10^{-4}\)</span>.</p>
<p>Secondly, test the ordinary scale, using the mean.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">nd</span><span class="o">.</span><span class="n">SinProblem</span><span class="p">()</span>
<span class="n">kmin</span> <span class="o">=</span> <span class="mf">1.0e-15</span>
<span class="n">kmax</span> <span class="o">=</span> <span class="mf">1.0e3</span>
<span class="n">logscale</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">plot_GMSW_step_history</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span> <span class="n">logscale</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_gill_murray_saunders_wright_011.png" srcset="../_images/sphx_glr_plot_gill_murray_saunders_wright_011.png" alt="GMSW on sin at x = 1.0. Log scale = False" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>kmin = 1.000e-15, c(kmin) = inf
kmax = 1.000e+03, c(kmax) = 5.431e-15
Iter #0, kmin = 1.000e-15, kmax = 1.000e+03, k = 5.000e+02, c(k) = 1.262e-15
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #1, kmin = 1.000e-15, kmax = 5.000e+02, k = 2.500e+02, c(k) = 3.131e-15
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #2, kmin = 1.000e-15, kmax = 2.500e+02, k = 1.250e+02, c(k) = 1.120e-14
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #3, kmin = 1.000e-15, kmax = 1.250e+02, k = 6.250e+01, c(k) = 4.356e-14
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #4, kmin = 1.000e-15, kmax = 6.250e+01, k = 3.125e+01, c(k) = 1.731e-13
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #5, kmin = 1.000e-15, kmax = 3.125e+01, k = 1.562e+01, c(k) = 1.190e-15
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #6, kmin = 1.000e-15, kmax = 1.562e+01, k = 7.813e+00, c(k) = 2.480e-15
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #7, kmin = 1.000e-15, kmax = 7.813e+00, k = 3.906e+00, c(k) = 1.381e-15
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #8, kmin = 1.000e-15, kmax = 3.906e+00, k = 1.953e+00, c(k) = 1.731e-15
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #9, kmin = 1.000e-15, kmax = 1.953e+00, k = 9.766e-01, c(k) = 5.400e-15
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #10, kmin = 1.000e-15, kmax = 9.766e-01, k = 4.883e-01, c(k) = 2.034e-14
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #11, kmin = 1.000e-15, kmax = 4.883e-01, k = 2.441e-01, c(k) = 8.015e-14
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #12, kmin = 1.000e-15, kmax = 2.441e-01, k = 1.221e-01, c(k) = 3.194e-13
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #13, kmin = 1.000e-15, kmax = 1.221e-01, k = 6.104e-02, c(k) = 1.276e-12
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #14, kmin = 1.000e-15, kmax = 6.104e-02, k = 3.052e-02, c(k) = 5.105e-12
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #15, kmin = 1.000e-15, kmax = 3.052e-02, k = 1.526e-02, c(k) = 2.042e-11
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #16, kmin = 1.000e-15, kmax = 1.526e-02, k = 7.629e-03, c(k) = 8.167e-11
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #17, kmin = 1.000e-15, kmax = 7.629e-03, k = 3.815e-03, c(k) = 3.267e-10
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #18, kmin = 1.000e-15, kmax = 3.815e-03, k = 1.907e-03, c(k) = 1.307e-09
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #19, kmin = 1.000e-15, kmax = 1.907e-03, k = 9.537e-04, c(k) = 5.227e-09
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #20, kmin = 1.000e-15, kmax = 9.537e-04, k = 4.768e-04, c(k) = 2.091e-08
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #21, kmin = 1.000e-15, kmax = 4.768e-04, k = 2.384e-04, c(k) = 8.363e-08
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #22, kmin = 1.000e-15, kmax = 2.384e-04, k = 1.192e-04, c(k) = 3.345e-07
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #23, kmin = 1.000e-15, kmax = 1.192e-04, k = 5.960e-05, c(k) = 1.338e-06
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #24, kmin = 1.000e-15, kmax = 5.960e-05, k = 2.980e-05, c(k) = 5.352e-06
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #25, kmin = 1.000e-15, kmax = 2.980e-05, k = 1.490e-05, c(k) = 2.141e-05
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #26, kmin = 1.000e-15, kmax = 1.490e-05, k = 7.451e-06, c(k) = 8.563e-05
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #27, kmin = 1.000e-15, kmax = 7.451e-06, k = 3.725e-06, c(k) = 3.425e-04
  c(k) &lt; c_threshold_min: reduce kmax.
Iter #28, kmin = 1.000e-15, kmax = 3.725e-06, k = 1.863e-06, c(k) = 1.370e-03
  c in [0.001, 0.1]: stop!
Number of iterations = 28
History of steps k : [500.0, 250.0, 125.0, 62.5, 31.25, 15.625, 7.812500000000001, 3.906250000000001, 1.9531250000000009, 0.976562500000001, 0.488281250000001, 0.244140625000001, 0.122070312500001, 0.061035156250001, 0.030517578125001, 0.015258789062501, 0.007629394531250999, 0.0038146972656259996, 0.0019073486328134999, 0.00095367431640725, 0.00047683715820412496, 0.0002384185791025625, 0.00011920928955178124, 5.960464477639062e-05, 2.980232238869531e-05, 1.4901161194847655e-05, 7.450580597923828e-06, 3.725290299461914e-06, 1.862645150230957e-06]
Last step k : 1.862645150230957e-06
f^(4)(x) = 0.8414709848078965
Optimal step k for f^(2)(x) = 0.0002748213843759035
</pre></div>
</div>
<p>In the previous plot, we see that the error first decreases
down to an error approximately equal to <span class="math notranslate nohighlight">\(10^{-4}\)</span>.
Then the error slightly increases before the algorithm stops.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 2.695 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-example-plot-gill-murray-saunders-wright-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/2353d809f4356f9b0bbe3361aa40f871/plot_gill_murray_saunders_wright.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_gill_murray_saunders_wright.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/c25a0f2f8d4ac18168a606d7c59420e9/plot_gill_murray_saunders_wright.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_gill_murray_saunders_wright.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/0434498d654eb9b13ee66b994a69bce3/plot_gill_murray_saunders_wright.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">plot_gill_murray_saunders_wright.zip</span></code></a></p>
</div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">numericalderivative</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/user_manual.html">User manual</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../examples/examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plot_numericalderivative.html">A simple demonstration of the methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_openturns.html">Applies Stepleman &amp; Winarsky method to an OpenTURNS function</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_use_benchmark.html">Use the benchmark problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_finite_differences.html">Use the finite differences formulas</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_general_fd.html">Use the generalized finite differences formulas</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_general_fd_convergence.html">Convergence of the generalized finite differences formulas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/examples.html#dumontet-vignes">Dumontet &amp; Vignes</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../examples/examples.html#gill-murray-saunders-wright">Gill, Murray, Saunders &amp; Wright</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Experiment with Gill, Murray, Saunders and Wright method</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_gill_murray_saunders_wright_benchmark.html">Benchmark Gill, Murray, Saunders and Wright method</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/examples.html#stepleman-winarsky">Stepleman &amp; Winarsky</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/examples.html#shi-xie-xuan-nocedal">Shi, Xie, Xuan &amp; Nocedal</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../examples/examples.html">Examples</a><ul>
      <li>Previous: <a href="plot_dumontet_vignes_benchmark.html" title="previous chapter">Benchmark Dumontet &amp; Vignes method</a></li>
      <li>Next: <a href="plot_gill_murray_saunders_wright_benchmark.html" title="next chapter">Benchmark Gill, Murray, Saunders and Wright method</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;M. Baudin.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/auto_example/plot_gill_murray_saunders_wright.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>